<?xml version="1.0" encoding="utf-8"?>
<Talents>

    <!--魔法天赋 增加50%技能获取速度，增加10%修复速度-->
    <Talent identifier="Talents_Magician_Primary01">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Buff.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Talents_Magician_Primary01"/>
        <AbilityGroupEffect abilityeffecttype="None">
            <Abilities>
                <CharacterAbilityGiveStat stattype="SkillGainSpeed" value="0.5"/>
                <CharacterAbilityGiveStat stattype="RepairSpeed" value="0.1"/>
            </Abilities>
        </AbilityGroupEffect>
    </Talent>

    <!--样样精通 增加5点所有技能水平加成，解锁配方：月饼-->
    <Talent identifier="Talents_Magician_Primary02">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Buff.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Talents_Magician_Primary02"/>
        <AbilityGroupEffect abilityeffecttype="None">
            <Abilities>
                <CharacterAbilityGiveStat stattype="ElectricalSkillBonus" value="5"/>
                <CharacterAbilityGiveStat stattype="HelmSkillBonus" value="5"/>
                <CharacterAbilityGiveStat stattype="MechanicalSkillBonus" value="5"/>
                <CharacterAbilityGiveStat stattype="MedicalSkillBonus" value="5"/>
                <CharacterAbilityGiveStat stattype="WeaponsSkillBonus" value="5"/>
            </Abilities>
        </AbilityGroupEffect>
        <AddedRecipe itemidentifier="Touhou_Fullmoon_Dumpling" />
        <AddedRecipe itemidentifier="Touhou_Moon_Cake" />
    </Talent>

    <!--还有谁不会飞？ 在水中的行动速度加快15%，同时受到的伤害降低10%-->
    <Talent identifier="Talents_Magician_Primary03">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Survivable.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Talents_Magician_Primary03"/>
        <AbilityGroupEffect abilityeffecttype="None">
            <Conditions>
                <AbilityConditionInWater/>
            </Conditions>
            <Abilities>
                <CharacterAbilityGiveStat stattype="SwimmingSpeed" value="0.15"/>
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="OnAttacked">
            <Conditions>
                <AbilityConditionInWater/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyAttackData addeddamagemultiplier="-0.1" />
            </Abilities>
        </AbilityGroupEffect>
    </Talent>

    <!--航行日志 完成巢穴任务、猎杀任务、货运任务、护送任务时额外获得10%经验值，如果无人死亡，则额外获得10%-->
    <Talent identifier="Talents_Magician_Primary04">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Buff.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Talents_Magician_Primary04"/>
        <AbilityGroupEffect abilityeffecttype="OnGainMissionExperience">
            <Conditions>
                <AbilityConditionMission missiontype="Monster,Nest,Cargo,Escort"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyValue addedvalue="0.1"/>
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="OnGainMissionExperience">
            <Conditions>
                <AbilityConditionMission missiontype="Monster,Nest,Cargo,Escort"/>
                <AbilityConditionNoCrewDied/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyValue addedvalue="0.1"/>
            </Abilities>
        </AbilityGroupEffect>
    </Talent>

    <!--魔法开掘 使用以太层金属或星界层金属提炼元素瓶时，有15%概率获得双倍产出，有5%概率再额外获得一倍产出。巡回完成任意任务，如果没有人死亡，则获得一块以太层金属-->
    <Talent identifier="Talents_Magician_Primary05">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Production.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Talents_Magician_Primary05"/>
        <AbilityGroupEffect abilityeffecttype="OnItemDeconstructedMaterial">
            <Conditions>
                <AbilityConditionServerRandom randomchance="0.15"/>
                <AbilityConditionItem tags="Touhou_Magic_Metal"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyValue multiplyvalue="2"/>
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="OnItemDeconstructedMaterial">
            <Conditions>
                <AbilityConditionServerRandom randomchance="0.05"/>
                <AbilityConditionItem tags="Touhou_Magic_Metal"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyValue multiplyvalue="2"/>
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="OnAnyMissionCompleted">
            <Conditions>
                <AbilityConditionNoCrewDied assistantsdontcount="false"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityPutItem itemidentifier="Touhou_Base_Metal" amount="1"/>
            </Abilities>
        </AbilityGroupEffect>
    </Talent>

    <!--修行 根据当前魔法能力的水平，提高相应10%的移动速度、远程射击速度和攻击伤害。这个效果在魔法能力到达400时达到上限-->
    <Talent identifier="Talents_Magician_Primary06">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Ranged.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Talents_Magician_Primary06"/>
        <AbilityGroupInterval interval="3.0">
            <Conditions>
                <AbilityConditionHasSkill skillidentifier="Touhou_Magic" minvalue="400" invert="true" />
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyStatToSkill stattype="MovementSpeed" maxvalue="0.1" skillidentifier="Touhou_Magic" />
                <CharacterAbilityModifyStatToSkill stattype="RangedAttackSpeed" maxvalue="0.1" skillidentifier="Touhou_Magic" />
            </Abilities>
            <FallbackAbilities>
                <CharacterAbilityModifyStat stattype="MovementSpeed" value="0.4" />
                <CharacterAbilityModifyStat stattype="RangedAttackSpeed" value="0.4" />
            </FallbackAbilities>
        </AbilityGroupInterval>
    </Talent>

    <!--妖怪退治 对非人类造成的物理伤害提高15%，对友军造成的伤害减少30%-->
    <Talent identifier="Talents_Magician_Primary07">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Direct_Damage.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Talents_Magician_Primary07"/>
        <AbilityGroupEffect abilityeffecttype="OnAddDamageAffliction">
            <Conditions>
                <AbilityConditionCharacter>
                    <Conditional speciesname="neq human" />
                </AbilityConditionCharacter>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyAffliction afflictionidentifiers="internaldamage,blunttrauma,lacerations,bitewounds,gunshotwound,organdamage,explosiondamage,Reiki_Pressure,Touhou_Bite" addedmultiplier="0.15" />
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="None">
            <Abilities>
                <CharacterAbilityGiveStat stattype="TeamAttackMultiplier" value="-0.3"/>
            </Abilities>
        </AbilityGroupEffect>
    </Talent>

    <!--物理魔法使 受水流冲击影响减少30%，增加15%最大生命值，解锁配方：退魔圣焰，祓魔霰弹-->
    <Talent identifier="Talents_Magician_Primary08">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Survivable.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Talents_Magician_Primary08"/>
        <AbilityGroupEffect abilityeffecttype="None">
            <Abilities>
                <CharacterAbilityGiveStat stattype="FlowResistance" value="0.3"/>
                <CharacterAbilityGiveStat stattype="MaximumHealthMultiplier" value="0.15"/>
            </Abilities>
        </AbilityGroupEffect>
        <AddedRecipe itemidentifier="Touhou_Winchester" />
        <AddedRecipe itemidentifier="Exorcism_Bullet" />
    </Talent>

    <!--宴会 每次巡回结束后，如果没有人死亡，则恢复所有人一部分的物理伤害、烧伤、出血、失血和死神之税-->
    <Talent identifier="Gensokyo_Banquet">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Support.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Gensokyo_Banquet"/>
        <AbilityGroupEffect abilityeffecttype="OnAnyMissionCompleted">
            <Conditions>
                <AbilityConditionNoCrewDied assistantsdontcount="false"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityApplyStatusEffectsToAllies requiresalive="true" allowself="true">
                    <StatusEffects>
                        <StatusEffect type="OnAbility" target="Character" disabledeltatime="true">
                            <Affliction identifier="Gensokyo_Banquet_Effect" amount="5"/>
                        </StatusEffect>
                    </StatusEffects>
                </CharacterAbilityApplyStatusEffectsToAllies>
            </Abilities>
        </AbilityGroupEffect>
    </Talent>

    <!--飘逸 受到攻击时有25%概率减少40%的承受伤害，这个效果有2秒冷却-->
    <Talent identifier="Gensokyo_Hermit">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Defense.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Gensokyo_Hermit"/>
        <AbilityGroupEffect abilityeffecttype="OnAttacked">
            <Conditions>
                <AbilityConditionServerRandom randomchance="0.25" />
                <AbilityConditionHasAffliction afflictionidentifier="Gensokyo_Hermit_CD" invert="true" />
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyAttackData addeddamagemultiplier="-0.4" />
                <CharacterAbilityApplyStatusEffects>
                    <StatusEffects>
                        <StatusEffect type="OnAbility" target="Character" delay="0.05" multiplyafflictionsbymaxvitality="true">
                            <Affliction identifier="Gensokyo_Hermit_CD" amount="1.0"/>
                        </StatusEffect>
                    </StatusEffects>
                </CharacterAbilityApplyStatusEffects>
            </Abilities>
        </AbilityGroupEffect>
    </Talent>

    <!--超出常识 获得对灵气紊乱25%的抗性，当魔法能力不满70但大于30时，为所有技能（原版技能）提供5点加成；大于70时，提供10点加成。-->
    <Talent identifier="Enter_Gensokyo">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Buff.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Enter_Gensokyo"/>
        <AbilityGroupInterval interval="0.9">
            <Abilities>
                <CharacterAbilityModifyResistance resistanceid="Reiki_Side_Effect" multiplier="0.75"/>
            </Abilities>
        </AbilityGroupInterval>
        <AbilityGroupEffect abilityeffecttype="None">
            <Conditions>
                <AbilityConditionHasSkill skillidentifier="Touhou_Magic" minvalue="70" invert="true" />
                <AbilityConditionHasSkill skillidentifier="Touhou_Magic" minvalue="30" />
            </Conditions>
            <Abilities>
                <CharacterAbilityGiveStat stattype="ElectricalSkillBonus" value="5"/>
                <CharacterAbilityGiveStat stattype="HelmSkillBonus" value="5"/>
                <CharacterAbilityGiveStat stattype="MechanicalSkillBonus" value="5"/>
                <CharacterAbilityGiveStat stattype="MedicalSkillBonus" value="5"/>
                <CharacterAbilityGiveStat stattype="WeaponsSkillBonus" value="5"/>
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="None">
            <Conditions>
                <AbilityConditionHasSkill skillidentifier="Touhou_Magic" minvalue="70" />
            </Conditions>
            <Abilities>
                <CharacterAbilityGiveStat stattype="ElectricalSkillBonus" value="10"/>
                <CharacterAbilityGiveStat stattype="HelmSkillBonus" value="10"/>
                <CharacterAbilityGiveStat stattype="MechanicalSkillBonus" value="10"/>
                <CharacterAbilityGiveStat stattype="MedicalSkillBonus" value="10"/>
                <CharacterAbilityGiveStat stattype="WeaponsSkillBonus" value="10"/>
            </Abilities>
        </AbilityGroupEffect>
    </Talent>

    <!--居酒屋 拥有对醉酒的80%的抗性，受到攻击后，短暂提高10%烧伤抗性和出血抗性，解锁配方：啤酒，友谊果汁-->
    <Talent identifier="Izakaya">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Defense.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Izakaya"/>
        <AbilityGroupEffect abilityeffecttype="None">
            <Abilities>
                <CharacterAbilityGiveResistance resistanceid="drunk" multiplier="0.2" />
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupInterval>
            <Conditions>
                <AbilityConditionHasAffliction afflictionidentifier="drunk"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyResistance resistanceid="nausea" multiplier="0.2"/>
            </Abilities>
        </AbilityGroupInterval>
        <AbilityGroupInterval interval="5.0">
            <Abilities>
                <CharacterAbilityApplyStatusEffects>
                    <StatusEffects>
                        <StatusEffect type="OnAbility" target="This" disabledeltatime="true">
                            <Affliction identifier="Izakaya_Effect_CD" amount="10"/>
                        </StatusEffect>
                    </StatusEffects>
                </CharacterAbilityApplyStatusEffects>
            </Abilities>
        </AbilityGroupInterval>
        <AbilityGroupEffect abilityeffecttype="OnAttacked">
            <Conditions>
                <AbilityConditionHasAffliction afflictionidentifier="Izakaya_Effect_CD"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityApplyStatusEffects>
                    <StatusEffects>
                        <StatusEffect type="OnAbility" target="Character" disabledeltatime="true">
                            <Affliction identifier="Izakaya_Effect" amount="1.0"/>
                        </StatusEffect>
                    </StatusEffects>
                </CharacterAbilityApplyStatusEffects>
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="OnAttackedResult">
            <Abilities>
                <CharacterAbilityApplyStatusEffects>
                    <StatusEffects>
                        <StatusEffect type="OnAbility" target="This">
                            <ReduceAffliction identifier="Izakaya_Effect_CD" strength="100.0"/>
                        </StatusEffect>
                    </StatusEffects>
                </CharacterAbilityApplyStatusEffects>
            </Abilities>
        </AbilityGroupEffect>
        <AddedRecipe itemidentifier="Touhou_Beer" />
        <AddedRecipe itemidentifier="Touhou_Friendship_Juice" />
    </Talent>

    <!--留心，AnyMission和AllMissions写法不同，有一个s的差别，记得留心-->

    <!--幻想入 巡回完成任意任务时获得所有技能和魔法能力1.5点，给予其他船员0.5点。为魔法使/魔法少女角色装束+提供额外效果。解锁配方：幻想潜水服-->
    <Talent identifier="Gensokyo_Divinggear_Unlocked">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Buff.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Gensokyo_Divinggear_Unlocked"/>
        <AbilityGroupEffect abilityeffecttype="OnAnyMissionCompleted">
            <Abilities>
                <CharacterAbilityApplyStatusEffects>
                    <StatusEffects>
                        <StatusEffect type="OnAbility" target="Character" disabledeltatime="true">
                            <GiveSkill skillidentifier="electrical" amount="1.5" triggertalents="false" />
                            <GiveSkill skillidentifier="helm" amount="1.5" triggertalents="false"/>
                            <GiveSkill skillidentifier="mechanical" amount="1.5" triggertalents="false"/>
                            <GiveSkill skillidentifier="medical" amount="1.5" triggertalents="false"/>
                            <GiveSkill skillidentifier="weapons" amount="1.5" triggertalents="false"/>
                            <GiveSkill skillidentifier="Touhou_Magic" amount="1.5" triggertalents="false"/>
                        </StatusEffect>
                    </StatusEffects>
                </CharacterAbilityApplyStatusEffects>
                <CharacterAbilityApplyStatusEffectsToAllies requiresalive="true" allowself="false">
                    <StatusEffects>
                        <StatusEffect type="OnAbility" target="Character" disabledeltatime="true">
                            <GiveSkill skillidentifier="electrical" amount="0.5" triggertalents="false" />
                            <GiveSkill skillidentifier="helm" amount="0.5" triggertalents="false"/>
                            <GiveSkill skillidentifier="mechanical" amount="0.5" triggertalents="false"/>
                            <GiveSkill skillidentifier="medical" amount="0.5" triggertalents="false"/>
                            <GiveSkill skillidentifier="weapons" amount="0.5" triggertalents="false"/>
                            <GiveSkill skillidentifier="Touhou_Magic" amount="0.5" triggertalents="false"/>
                        </StatusEffect>
                    </StatusEffects>
                </CharacterAbilityApplyStatusEffectsToAllies>
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupInterval interval="4.9">
            <Conditions>
                <AbilityConditionHasAffliction afflictionidentifier="The_Still_Library" />
            </Conditions>
            <Abilities>
                <CharacterAbilityApplyStatusEffects>
                    <StatusEffects>
                        <StatusEffect type="OnAbility" target="Character" disabledeltatime="true" multiplyafflictionsbymaxvitality="true">
                            <Affliction identifier="Gensokyo_Divinggear_Unlocked_Effect01" strength="1.0"/>
                        </StatusEffect>
                    </StatusEffects>
                </CharacterAbilityApplyStatusEffects>
            </Abilities>
        </AbilityGroupInterval>
        <AbilityGroupInterval interval="4.9">
            <Conditions>
                <AbilityConditionHasAffliction afflictionidentifier="Ordinary_Magician" />
            </Conditions>
            <Abilities>
                <CharacterAbilityApplyStatusEffects>
                    <StatusEffects>
                        <StatusEffect type="OnAbility" target="Character" disabledeltatime="true" multiplyafflictionsbymaxvitality="true">
                            <Affliction identifier="Gensokyo_Divinggear_Unlocked_Effect02" strength="1.0"/>
                        </StatusEffect>
                    </StatusEffects>
                </CharacterAbilityApplyStatusEffects>
            </Abilities>
        </AbilityGroupInterval>
        <AbilityGroupInterval interval="4.9">
            <Conditions>
                <AbilityConditionHasAffliction afflictionidentifier="Younger_Sister_Of_Scarlet" />
            </Conditions>
            <Abilities>
                <CharacterAbilityApplyStatusEffects>
                    <StatusEffects>
                        <StatusEffect type="OnAbility" target="Character" disabledeltatime="true" multiplyafflictionsbymaxvitality="true">
                            <Affliction identifier="Gensokyo_Divinggear_Unlocked_Effect03" strength="1.0"/>
                        </StatusEffect>
                    </StatusEffects>
                </CharacterAbilityApplyStatusEffects>
            </Abilities>
        </AbilityGroupInterval>
        <AbilityGroupInterval interval="0.5">
            <Conditions>
                <AbilityConditionHasSkill skillidentifier="Touhou_Magic" minvalue="300" invert="true" />
                <AbilityConditionHasAffliction afflictionidentifier="Younger_Sister_Of_Scarlet" />
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyStatToSkill stattype="MaximumHealthMultiplier" maxvalue="0.1" skillidentifier="Touhou_Magic" />
            </Abilities>
        </AbilityGroupInterval>
        <AbilityGroupInterval interval="0.5">
            <Conditions>
                <AbilityConditionHasSkill skillidentifier="Touhou_Magic" minvalue="300" />
                <AbilityConditionHasAffliction afflictionidentifier="Younger_Sister_Of_Scarlet" />
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyStat stattype="MaximumHealthMultiplier" value="0.3" />
            </Abilities>
        </AbilityGroupInterval>
        <AddedRecipe itemidentifier="gensokyo_divinggear" />
    </Talent>

    <!--炼金无限 瓶装元素的出售价格增加至75%，双手部位的物理伤害抗性和烧伤抗性提高5%，解锁配方：回收日、月符卡-->
    <Talent identifier="Spell_Card_Recycle_Unlocked">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Defense.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Spell_Card_Recycle_Unlocked"/>
        <AbilityGroupEffect abilityeffecttype="None">
            <Abilities>
                <CharacterAbilityGivePermanentStat statidentifier="Mu_Alchemical" stattype="StoreSellMultiplier" value="0.75" targetallies="false" setvalue="true" />
                <CharacterAbilityGivePermanentStat statidentifier="Huo_Alchemical" stattype="StoreSellMultiplier" value="0.75" targetallies="false" setvalue="true" />
                <CharacterAbilityGivePermanentStat statidentifier="Tu_Alchemical" stattype="StoreSellMultiplier" value="0.75" targetallies="false" setvalue="true" />
                <CharacterAbilityGivePermanentStat statidentifier="Jin_Alchemical" stattype="StoreSellMultiplier" value="0.75" targetallies="false" setvalue="true" />
                <CharacterAbilityGivePermanentStat statidentifier="Shui_Alchemical" stattype="StoreSellMultiplier" value="0.75" targetallies="false" setvalue="true" />
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupInterval interval="9.9">
            <Abilities>
                <CharacterAbilityApplyStatusEffects>
                    <StatusEffects>
                        <StatusEffect type="OnAbility" target="Character" disabledeltatime="true" multiplyafflictionsbymaxvitality="true">
                            <Affliction identifier="Spell_Card_Recycle_Unlocked_Effect" strength="1.0"/>
                        </StatusEffect>
                    </StatusEffects>
                </CharacterAbilityApplyStatusEffects>
            </Abilities>
        </AbilityGroupInterval>
        <AddedRecipe itemidentifier="Touhou_Royal_Flare" />
        <AddedRecipe itemidentifier="Touhou_Silent_Selene_Ammo" />
    </Talent>

    <!--魔法突破 制造所有物品时质量提升1，如果是帕秋莉+/魔理沙+/芙兰朵露+/爱丽丝+装束，则质量再提升1-->
    <Talent identifier="Magic_Breakthrough">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Buff.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Magic_Breakthrough"/>
        <AbilityGroupInterval interval="4.9">
            <Abilities>
                <CharacterAbilityApplyStatusEffects>
                    <StatusEffects>
                        <StatusEffect type="OnAbility" target="Character" disabledeltatime="true" multiplyafflictionsbymaxvitality="true">
                            <Affliction identifier="Magic_Breakthrough_Effect01" strength="1.0"/>
                        </StatusEffect>
                    </StatusEffects>
                </CharacterAbilityApplyStatusEffects>
            </Abilities>
        </AbilityGroupInterval>
        <AbilityGroupInterval interval="4.9">
            <Conditions>
                <AbilityConditionHasAffliction afflictionidentifier="The_Still_Library" />
            </Conditions>
            <Abilities>
                <CharacterAbilityApplyStatusEffects>
                    <StatusEffects>
                        <StatusEffect type="OnAbility" target="Character" disabledeltatime="true" multiplyafflictionsbymaxvitality="true">
                            <Affliction identifier="Magic_Breakthrough_Effect02" strength="1.0"/>
                        </StatusEffect>
                    </StatusEffects>
                </CharacterAbilityApplyStatusEffects>
            </Abilities>
        </AbilityGroupInterval>
        <AbilityGroupInterval interval="4.9">
            <Conditions>
                <AbilityConditionHasAffliction afflictionidentifier="Ordinary_Magician" />
            </Conditions>
            <Abilities>
                <CharacterAbilityApplyStatusEffects>
                    <StatusEffects>
                        <StatusEffect type="OnAbility" target="Character" disabledeltatime="true" multiplyafflictionsbymaxvitality="true">
                            <Affliction identifier="Magic_Breakthrough_Effect02" strength="1.0"/>
                        </StatusEffect>
                    </StatusEffects>
                </CharacterAbilityApplyStatusEffects>
            </Abilities>
        </AbilityGroupInterval>
        <AbilityGroupInterval interval="4.9">
            <Conditions>
                <AbilityConditionHasAffliction afflictionidentifier="Younger_Sister_Of_Scarlet" />
            </Conditions>
            <Abilities>
                <CharacterAbilityApplyStatusEffects>
                    <StatusEffects>
                        <StatusEffect type="OnAbility" target="Character" disabledeltatime="true" multiplyafflictionsbymaxvitality="true">
                            <Affliction identifier="Magic_Breakthrough_Effect02" strength="1.0"/>
                        </StatusEffect>
                    </StatusEffects>
                </CharacterAbilityApplyStatusEffects>
            </Abilities>
        </AbilityGroupInterval>
        <AbilityGroupInterval interval="4.9">
            <Conditions>
                <AbilityConditionHasAffliction afflictionidentifier="Puppeteer_Of_Seven_Colors" />
            </Conditions>
            <Abilities>
                <CharacterAbilityApplyStatusEffects>
                    <StatusEffects>
                        <StatusEffect type="OnAbility" target="Character" disabledeltatime="true" multiplyafflictionsbymaxvitality="true">
                            <Affliction identifier="Magic_Breakthrough_Effect02" strength="1.0"/>
                        </StatusEffect>
                    </StatusEffects>
                </CharacterAbilityApplyStatusEffects>
            </Abilities>
        </AbilityGroupInterval>
    </Talent>

    <!--逆位隐士 魔法材料的制造速度增加50%，造成的毒药效果提高20%，解锁配方：污秽药剂-->
    <Talent identifier="Foul_Potion_Unlocked">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Indirect_Damage.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Foul_Potion_Unlocked"/>
        <AbilityGroupEffect abilityeffecttype="None">
            <Abilities>
                <CharacterAbilityGiveStat stattype="PoisonMultiplier" value="0.2"/>
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="None">
            <Abilities>
                <CharacterAbilityGivePermanentStat statidentifier="Touhou_Magic_Item" stattype="FabricationSpeed" value="0.5" setvalue="true"/>
            </Abilities>
        </AbilityGroupEffect>
        <AddedRecipe itemidentifier="Touhou_Foul_Potion" />
    </Talent>

    <!--正位隐士 提供的增益持续时间延长30%，获得对毒药40%的抗性-->
    <Talent identifier="Touhou_Buff">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Defense.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Touhou_Buff"/>
        <AbilityGroupEffect abilityeffecttype="None">
            <Abilities>
                <CharacterAbilityGiveStat stattype="BuffItemApplyingMultiplier" value="0.3"/>
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupInterval interval="29.0">
            <Abilities>
                <CharacterAbilityApplyStatusEffects>
                    <StatusEffects>
                        <StatusEffect type="OnAbility" target="Character" disabledeltatime="true" multiplyafflictionsbymaxvitality="true">
                            <Affliction identifier="Touhou_Buff_Effect" strength="1.0"/>
                        </StatusEffect>
                    </StatusEffects>
                </CharacterAbilityApplyStatusEffects>
            </Abilities>
        </AbilityGroupInterval>
    </Talent>

    <!--三重伟大 攻击伤害、攻击速度、物理抗性提高10%，解锁配方：贤者之石-->
    <Talent identifier="Hermes">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Buff.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Hermes"/>
        <AbilityGroupEffect abilityeffecttype="None">
            <Abilities>
                <CharacterAbilityGiveStat stattype="RangedAttackMultiplier" value="0.10"/>
                <CharacterAbilityGiveStat stattype="MeleeAttackMultiplier" value="0.10"/>
                <CharacterAbilityGiveStat stattype="RangedAttackSpeed" value="0.10"/>
                <CharacterAbilityGiveStat stattype="MeleeAttackSpeed" value="0.10"/>
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupInterval interval="4.9">
            <Abilities>
                <CharacterAbilityModifyResistance resistanceid="damage" multiplier="0.9" />
            </Abilities>
        </AbilityGroupInterval>
        <AddedRecipe itemidentifier="Seven_Elements_Alchemical" />
    </Talent>

    <!--旅行法师 完成巡回后，若无人死亡，则获得一本《魔法教学》，同时潜艇成员中等级小于6的成员获取经验值的速度加快20%-->
    <Talent identifier="Traveling_Magician">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Production.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Traveling_Magician"/>
        <AbilityGroupEffect abilityeffecttype="OnAnyMissionCompleted">
            <Conditions>
                <AbilityConditionNoCrewDied assistantsdontcount="false"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityPutItem itemidentifier="Touhou_Spell_Tutorial" amount="1"/>
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="OnAllyGainMissionExperience">
            <Conditions>
                <AbilityConditionHasLevel minlevel="6" invert="true"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyValue multiplyvalue="1.2"/>
            </Abilities>
        </AbilityGroupEffect>
    </Talent>

    <!--魔力外放 根据当前角色等级，提供不同加成：
        5级：魔法能力大于60后，每次攻击都有25%概率造成15%额外伤害
        10级：魔法能力大于80后，远程弹幕的伤害提高10%
        15级：魔法能力大于100后，在水中获得300秒免疫水压，回到干燥环境后这个效果的剩余时间将开始恢复-->
    <Talent identifier="Mana_Release">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Ranged.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Mana_Release"/>
        <AbilityGroupEffect abilityeffecttype="OnAttack">
            <Conditions>
                <AbilityConditionAttackData weapontype="Turret" invert="true"/>
                <AbilityConditionServerRandom randomchance="0.25" />
                <AbilityConditionHasSkill skillidentifier="Touhou_Magic" minvalue="60" />
                <AbilityConditionHasLevel minlevel="5" />
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyAttackData addeddamagemultiplier="0.15" />
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="OnAttack">
            <Conditions>
                <AbilityConditionAttackData tags="Touhou_Magic_Danmu" ignorenonharmfulattacks="true" weapontype="Ranged"/>
                <AbilityConditionHasSkill skillidentifier="Touhou_Magic" minvalue="80" />
                <AbilityConditionHasLevel minlevel="10" />
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyAttackData addeddamagemultiplier="0.1" />
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupInterval interval="4.9">
            <Conditions>
                <AbilityConditionInHull />
                <AbilityConditionHasSkill skillidentifier="Touhou_Magic" minvalue="100" />
                <AbilityConditionHasLevel minlevel="15" />
            </Conditions>
            <Abilities>
                <CharacterAbilityApplyStatusEffects>
                    <StatusEffects>
                        <StatusEffect type="OnAbility" target="Character" disabledeltatime="true" multiplyafflictionsbymaxvitality="true">
                            <Affliction identifier="Mana_Release_Effect" strength="25"/>
                        </StatusEffect>
                    </StatusEffects>
                </CharacterAbilityApplyStatusEffects>
            </Abilities>
        </AbilityGroupInterval>
    </Talent>

    <!--魔力内敛 根据当前角色等级，提供不同加成：
        5级后：每一级提供3%技能获取速度和1%经验获取速度，直到20级为止
        10级后：每一级提供2%游泳速度并减少2%双持惩罚，直到20级为止
        15级后：每次完成任意任务都会增加2%最大生命值，最大10%，死亡后效果清零-->
    <Talent identifier="Mana_Convergence" trackedstat="Mana_Convergence_Counter" trackedmax="5">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Buff.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Mana_Convergence"/>
        <AbilityGroupInterval interval="4.9">
            <Conditions>
                <AbilityConditionHasLevel minlevel="5" />
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyStatToLevel stattype="SkillGainSpeed" statperlevel="0.04" maxlevel="20" />
                <CharacterAbilityModifyStatToLevel stattype="ExperienceGainMultiplier" statperlevel="0.01" maxlevel="20" />
            </Abilities>
        </AbilityGroupInterval>
        <AbilityGroupInterval interval="4.9">
            <Conditions>
                <AbilityConditionHasLevel minlevel="10" />
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyStatToLevel stattype="SwimmingSpeed" statperlevel="0.02" maxlevel="20" />
                <CharacterAbilityModifyStatToLevel stattype="DualWieldingPenaltyReduction" statperlevel="0.02" maxlevel="20" />
            </Abilities>
        </AbilityGroupInterval>
        <AbilityGroupEffect abilityeffecttype="OnAnyMissionCompleted">
            <Conditions>
                <AbilityConditionHasPermanentStat statidentifier="Mana_Convergence_Counter" min="6" invert="true"/>
                <AbilityConditionHasLevel minlevel="15" />
            </Conditions>
            <Abilities>
                <CharacterAbilityGivePermanentStat statidentifier="Mana_Convergence_Counter" value="1" removeondeath="true" />
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupInterval interval="4.9">
            <Conditions>
                <AbilityConditionHasPermanentStat statidentifier="Mana_Convergence_Counter" min="1"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyStat stattype="MaximumHealthMultiplier" value="0.02" />
            </Abilities>
        </AbilityGroupInterval>
        <AbilityGroupInterval interval="4.9">
            <Conditions>
                <AbilityConditionHasPermanentStat statidentifier="Mana_Convergence_Counter" min="2"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyStat stattype="MaximumHealthMultiplier" value="0.02" />
            </Abilities>
        </AbilityGroupInterval>
        <AbilityGroupInterval interval="4.9">
            <Conditions>
                <AbilityConditionHasPermanentStat statidentifier="Mana_Convergence_Counter" min="3"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyStat stattype="MaximumHealthMultiplier" value="0.02" />
            </Abilities>
        </AbilityGroupInterval>
        <AbilityGroupInterval interval="4.9">
            <Conditions>
                <AbilityConditionHasPermanentStat statidentifier="Mana_Convergence_Counter" min="4"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyStat stattype="MaximumHealthMultiplier" value="0.02" />
            </Abilities>
        </AbilityGroupInterval>
        <AbilityGroupInterval interval="4.9">
            <Conditions>
                <AbilityConditionHasPermanentStat statidentifier="Mana_Convergence_Counter" min="5"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyStat stattype="MaximumHealthMultiplier" value="0.02" />
            </Abilities>
        </AbilityGroupInterval>
    </Talent>

    <!--远见卓识 每次巡回能额外接受一个任务，获得的声望增加25%，解锁配方：P点（红）（高效合成）-->
    <Talent identifier="Power_Point_Efficient_Synthesis">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Support.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.Power_Point_Efficient_Synthesis"/>
        <AbilityGroupEffect abilityeffecttype="None">
            <Abilities>
                <CharacterAbilityGiveStat stattype="ExtraMissionCount" value="1"/>
                <CharacterAbilityGiveStat stattype="ReputationGainMultiplier" value="0.25" />
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="None" >
            <Abilities>
                <CharacterAbilityGiveFlag flagtype="MoveNormallyWhileDragging" />
            </Abilities>
        </AbilityGroupEffect>
        <AddedRecipe itemidentifier="Power_Point" />
    </Talent>

    <!--魔法天才 周围的敌人越多，造成的伤害越高，伤害最高至30%。生命值低于50%后，这个效果翻倍。解锁配方：MEID-->
    <Talent identifier="MEID_Unlocked">
        <Icon texture="%ModDir%/Images/Talents/Touhou_Talents_Direct_Damage.png" sheetindex="0,0" sheetelementsize="400,400" />
        <Description tag="talentdescription.MEID_Unlocked"/>
        <AbilityGroupEffect abilityeffecttype="OnAttack">
            <Conditions>
                <AbilityConditionNearbyCharacterCount distance="500" targettypes="Enemy,Alive" count="2"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyAttackData addeddamagemultiplier="0.05" />
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="OnAttack">
            <Conditions>
                <AbilityConditionNearbyCharacterCount distance="500" targettypes="Enemy,Alive" count="2"/>
                <AbilityConditionAboveVitality invert="true" vitalitypercentage="0.5"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyAttackData addeddamagemultiplier="0.05" />
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="OnAttack">
            <Conditions>
                <AbilityConditionNearbyCharacterCount distance="500" targettypes="Enemy,Alive" count="4"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyAttackData addeddamagemultiplier="0.05" />
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="OnAttack">
            <Conditions>
                <AbilityConditionNearbyCharacterCount distance="500" targettypes="Enemy,Alive" count="4"/>
                <AbilityConditionAboveVitality invert="true" vitalitypercentage="0.5"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyAttackData addeddamagemultiplier="0.05" />
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="OnAttack">
            <Conditions>
                <AbilityConditionNearbyCharacterCount distance="500" targettypes="Enemy,Alive" count="6"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyAttackData addeddamagemultiplier="0.05" />
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="OnAttack">
            <Conditions>
                <AbilityConditionNearbyCharacterCount distance="500" targettypes="Enemy,Alive" count="6"/>
                <AbilityConditionAboveVitality invert="true" vitalitypercentage="0.5"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyAttackData addeddamagemultiplier="0.05" />
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="OnAttack">
            <Conditions>
                <AbilityConditionNearbyCharacterCount distance="500" targettypes="Enemy,Alive" count="8"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyAttackData addeddamagemultiplier="0.05" />
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="OnAttack">
            <Conditions>
                <AbilityConditionNearbyCharacterCount distance="500" targettypes="Enemy,Alive" count="8"/>
                <AbilityConditionAboveVitality invert="true" vitalitypercentage="0.5"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyAttackData addeddamagemultiplier="0.05" />
            </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="OnAttack">
            <Conditions>
                <AbilityConditionNearbyCharacterCount distance="500" targettypes="Enemy,Alive" count="10"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyAttackData addeddamagemultiplier="0.05" />
           </Abilities>
        </AbilityGroupEffect>
        <AbilityGroupEffect abilityeffecttype="OnAttack">
            <Conditions>
                <AbilityConditionNearbyCharacterCount distance="500" targettypes="Enemy,Alive" count="10"/>
                <AbilityConditionAboveVitality invert="true" vitalitypercentage="0.5"/>
            </Conditions>
            <Abilities>
                <CharacterAbilityModifyAttackData addeddamagemultiplier="0.05" />
           </Abilities>
        </AbilityGroupEffect>
        <AddedRecipe itemidentifier="Touhou_MEID" />
    </Talent>

</Talents>